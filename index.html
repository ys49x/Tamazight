<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>‚µú‚¥∞‚µé‚¥∞‚µ£‚µâ‚µñ‚µú Ai</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
  <style>
    /* Variables CSS - Th√®me Vista Aero */
    :root {
      --primary-color: #0078D7;
      --primary-hover: #106EBE;
      --text-color: #000000;
      --bg-color: #DCE6F2;
      --chat-bg: rgba(255, 255, 255, 0.8);
      --user-message: rgba(229, 241, 251, 0.8);
      --bot-message: rgba(240, 240, 240, 0.8);
      --container-bg: rgba(255, 255, 255, 0.7);
      --border-color: #A5B3C5;
      --suggestion-bg: rgba(229, 241, 251, 0.8);
      --suggestion-hover: rgba(201, 224, 247, 0.8);
      --glass-effect: blur(8px);
    }

    .dark-mode {
      --primary-color: #0078D7;
      --primary-hover: #106EBE;
      --text-color: #E5E5E5;
      --bg-color: #1A1A1A;
      --chat-bg: rgba(30, 30, 30, 0.8);
      --user-message: rgba(0, 90, 158, 0.8);
      --bot-message: rgba(50, 50, 50, 0.8);
      --container-bg: rgba(40, 40, 40, 0.7);
      --border-color: #555555;
      --suggestion-bg: rgba(0, 90, 158, 0.8);
      --suggestion-hover: rgba(0, 70, 128, 0.8);
    }

    /* Base Responsive */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Segoe WP', Tahoma, Arial, sans-serif;
      color: var(--text-color);

      line-height: 1.6;
      min-height: 100vh;
       display: flex;
       flex-direction: center; 
      transition: background-color 0.3s, color 0.3s;
      width:100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;   
      
      
      
      
    }

    .container {
      max-width:100%;
      width: 95%;
      background-color: var(--container-bg);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2),
                 inset 0 1px 0 rgba(255, 255, 255, 0.3);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      flex: 1;
            display: flex;

      flex-direction: column
    }

    /* Typographie Responsive */
    h2 {
      font-family: "Segoe UI Light", "Segoe WP", sans-serif;
      text-align: center;
      color: var(--primary-color);
      margin: 0 0 15px 0;
      font-weight: 300;
      text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
      font-size: clamp(1.5rem, 4vw, 2rem);
    }

    /* Zone de chat */
    #chat {
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 10px;
      flex: 1;
      overflow-y: auto;
      background-color: var(--chat-bg);
      margin-bottom: 10px;
      min-height: 200px;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1),
                 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    /* Groupe de saisie */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #userInput {
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: clamp(0.9rem, 3vw, 1rem);
      background-color: rgba(255, 255, 255, 0.8);
      color: var(--text-color);
      width: 100%;
      box-sizing: border-box;
    }

    /* Syst√®me de boutons responsive */
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .button-group-row {
      display: flex;
      width: 100%;
      gap: 8px;
    }
    
    .button-group button {
      flex: 1 1 auto;
      min-width: 100px;
      padding: 8px 12px;
      white-space: nowrap;
      background: linear-gradient(to bottom, #F6F6F6 0%, #E5E5E5 100%);
      border: 1px solid #A5B3C5;
      color: #000;
      border-radius: 4px;
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      font-weight: bold;
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.8);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1),
                 inset 0 0 1px rgba(255, 255, 255, 0.8);
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .button-group button:hover {
      background: linear-gradient(to bottom, #FFFFFF 0%, #F0F0F0 100%);
      border-color: #8BA2C4;
    }

    /* Boutons sp√©ciaux */
    #toggleAutoTTS, #speakBtn, #stopSpeakBtn {
      background: linear-gradient(to bottom, #E5F1FB 0%, #D0E5F5 100%);
      border-color: #8BA2C4;
    }

    #toggleAutoTTS:hover, #speakBtn:hover, #stopSpeakBtn:hover {
      background: linear-gradient(to bottom, #F0F7FC 0%, #E0EFF9 100%);
    }

    /* Contr√¥les TTS */
    .tts-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      width: 100%;
    }
    
    .tts-controls > * {
      flex: 1 1 auto;
      min-width: 60px;
    }
    
    #voiceSelect {
      min-width: 120px;
      padding: 8px;
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: rgba(255, 255, 255, 0.8);
    }

    /* Suggestions */
    #suggestions div {
      background: linear-gradient(to bottom, var(--suggestion-bg) 0%, #D0E5F5 100%);
      border: 1px solid var(--border-color);
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #suggestions div:hover {
      background: linear-gradient(to bottom, var(--suggestion-hover) 0%, #E0EFF9 100%);
    }

    /* √âl√©ments sp√©cifiques Vista */
    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 36px;
      height: 36px;
      background: linear-gradient(to bottom, #F6F6F6 0%, #E5E5E5 100%);
      border: 1px solid #A5B3C5;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }

    #viewCounter {
      position: fixed;
      bottom: 5px;
      right: 5px;
      padding: 6px 12px;
      font-size: 0.8rem;
      background: linear-gradient(to bottom, #E5F1FB 0%, #D0E5F5 100%);
      border: 1px solid #8BA2C4;
      border-radius: 4px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* Media Queries pour mobile */
    @media (max-width: 600px) {
      .container {
        padding: 10px;
        backdrop-filter: none;
        width: 92%;
        margin: 8px auto;
      }
      
      .button-group-row {
        flex-direction: column;
      }
      
      .button-group button {
        width: 100%;
        min-width: unset;
        padding: 10px;
      }
      
      .tts-controls {
        flex-direction: column;
      }
      
      #voiceSelect {
        width: 100%;
        min-width: unset;
      }
      
      #chat {
        min-height: 150px;
        padding: 8px;
      }
      
      #userInput {
        padding: 8px 10px;
      }
    }

    /* Pour tr√®s petits appareils */
    @media (max-width: 400px) {
      :root {
        --glass-effect: blur(4px);
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      .button-group button {
        font-size: 0.7rem;
        padding: 6px 8px;
      }
    }
  </style>   
</head>
<body>
  <button class="theme-toggle" id="themeToggle">üåì</button>
  <div class="container">
    <h2>Tama‚µ£ight Ai</h2>
    <div id="chat"></div>
    <div class="input-group">
      <input type="text" id="userInput" placeholder="Tapez un message..." autocomplete="off">
      <div id="suggestions"></div>
      
      <div class="button-group">
        <div class="button-group-row">
          <div class="main-actions">
            <button onclick="sendMessage()">Envoyer</button>
            <button onclick="promptSearch()">üîç Recherche</button>
          </div>
          <button id="toggleAutoTTS">Auto TTS: OFF</button>
          <button onclick="resetHistory()">Reset</button>
        </div>
        
        <div class="button-group-row">
          <div class="tts-controls">
            <button id="speakBtn" title="Lire">üîä</button>
            <button id="stopSpeakBtn" title="Arr√™ter">‚èπ</button>
            <select id="voiceSelect"></select>
            <input type="range" id="rateControl" min="0.5" max="2" step="0.1" value="1" title="Vitesse">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Compteur de vues -->
  <div id="viewCounter">‚µ¢‚¥∞‚µè ‚µì‚µ£‚µî‚¥∞‚µî: <span id="views">0</span></div>

  <script>
    // Charger l'image de fond
    const images = ["2.jpg"];
    const randomBg = images[Math.floor(Math.random() * images.length)];
    document.body.style.backgroundImage = `url(${randomBg})`;

    // Compteur de vues (localStorage)
    if (localStorage.getItem('views')) {
      let views = parseInt(localStorage.getItem('views')) + 1;
      localStorage.setItem('views', views);
      document.getElementById('views').textContent = views;
    } else {
      localStorage.setItem('views', 1);
      document.getElementById('views').textContent = 1;
    }

    // Gestion du th√®me
    const themeToggle = document.getElementById('themeToggle');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

    function applyDarkMode(isDark) {
      document.body.classList.toggle('dark-mode', isDark);
      themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    function checkTheme() {
      const savedTheme = localStorage.getItem('theme');
      const systemDark = prefersDarkScheme.matches;
      applyDarkMode(savedTheme ? savedTheme === 'dark' : systemDark);
    }

    themeToggle.addEventListener('click', () => applyDarkMode(!document.body.classList.contains('dark-mode')));
    prefersDarkScheme.addEventListener('change', checkTheme);
    checkTheme();

    // Gestion du chat
    function sendMessage() {
      const input = document.getElementById('userInput');
      const message = input.value.trim();
      
      if (message.startsWith("/search ")) {
        const query = message.substring(7).trim();
        if (query) webSearch(query, 5);
        input.value = '';
        return;
      }
      
      if (!message) return;

      const chat = document.getElementById('chat');
      chat.innerHTML += `<div><b>Vous :</b> ${message}</div>`;
      
      fetch('chatbot.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'message=' + encodeURIComponent(message)
      })
      .then(response => response.text())
      .then(data => {
        chat.innerHTML += `<div><b>Bot :</b> ${data}</div>`;
        input.value = '';
        chat.scrollTop = chat.scrollHeight;
        if (autoSpeak) speak(data);
      });
    }

    // Fonction de recherche web
    function promptSearch() {
      const query = prompt("Entrez votre recherche web:");
      if (query) {
        document.getElementById('userInput').value = `/search ${query}`;
        sendMessage();
      }
    }

    async function webSearch(query, limit = 5) {
      const chat = document.getElementById('chat');
      const searchId = 'search-' + Date.now();
      
      chat.innerHTML += `
        <div class="generating" id="${searchId}">
          üîç Recherche web pour: "${query}"...
          <div class="progress-bar"><div class="progress"></div></div>
        </div>
      `;

      try {
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.bing.com/search?q=${query}&count=${limit}`)}`;
        const response = await fetch(proxyUrl);
        
        if (!response.ok) throw new Error('Erreur r√©seau');
        
        const data = await response.json();
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        
        const results = Array.from(doc.querySelectorAll('.b_algo')).slice(0, limit);
        
        let htmlResults = `<div><b>R√©sultats web pour "${query}":</b><ol>`;
        
        results.forEach(item => {
          const title = item.querySelector('h2')?.textContent || 'Sans titre';
          const link = item.querySelector('a')?.href || '#';
          const desc = item.querySelector('.b_caption p')?.textContent || 'Aucune description';
          
          htmlResults += `
            <li>
              <a href="${link}" target="_blank" rel="noopener">${title}</a>
              <p>${desc}</p>
            </li>
          `;
        });
        
        htmlResults += `</ol><small>Source: Bing via proxy CORS</small></div>`;
        document.getElementById(searchId).outerHTML = htmlResults;
        
      } catch (error) {
        document.getElementById(searchId).innerHTML = `
          <div style="color:red">
            Erreur: ${error.message}<br>
            <small>Essayez une recherche plus simple ou r√©essayez plus tard</small>
          </div>
        `;
      }
    }

    // Suggestions
    const input = document.getElementById('userInput');
    const suggestionsBox = document.getElementById('suggestions');

    input.addEventListener('input', () => {
      const query = input.value.trim();
      if (query.length < 1) {
        suggestionsBox.innerHTML = '';
        return;
      }

      fetch('suggestions.php?term=' + encodeURIComponent(query))
        .then(res => res.json())
        .then(data => {
          suggestionsBox.innerHTML = data.map(item => 
            `<div onclick="this.parentNode.innerHTML='';document.getElementById('userInput').value='${item.replace(/'/g, "\\'")}'">${item}</div>`
          ).join('');
        });
    });

    function resetHistory() {
      fetch('reset.php').then(() => document.getElementById('chat').innerHTML = '');
    }

    // Gestion TTS
    let ttsEnabled = true;
    let voices = [];
    let currentUtterance = null;
    let autoSpeak = localStorage.getItem('autoTTS') === 'true';

    document.addEventListener('DOMContentLoaded', initTTS);

    function initTTS() {
      if (!('speechSynthesis' in window)) {
        console.warn('TTS non support√©');
        ttsEnabled = true;
        return;
      }

      speechSynthesis.onvoiceschanged = populateVoiceList;
      if (speechSynthesis.getVoices().length > 0) populateVoiceList();

      document.getElementById('toggleAutoTTS').addEventListener('click', toggleAutoTTS);
      document.getElementById('speakBtn').addEventListener('click', speakLastResponse);
      document.getElementById('stopSpeakBtn').addEventListener('click', stopSpeaking);
      document.getElementById('voiceSelect').addEventListener('change', setVoice);
      document.getElementById('rateControl').addEventListener('input', setRate);
      document.getElementById('userInput').addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
    }

    function populateVoiceList() {
      voices = speechSynthesis.getVoices();
      const voiceSelect = document.getElementById('voiceSelect');
      voiceSelect.innerHTML = '';
      
      const preferredVoices = [
        ...voices.filter(v => v.lang.includes('fr')),
        ...voices.filter(v => v.lang.includes('ar')),
        ...voices
      ].filter((v, i, a) => a.findIndex(t => t.name === v.name) === i);

      preferredVoices.forEach(voice => {
        const option = document.createElement('option');
        option.textContent = `${voice.name} (${voice.lang})`;
        option.setAttribute('data-voice', voice.name);
        voiceSelect.appendChild(option);
      });
    }

    function speak(text) {
      if (!ttsEnabled) return;
      stopSpeaking();
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = text.match(/[\u2D30-\u2D7F]/) ? 'ar-MA' : 'fr-FR';
      utterance.rate = parseFloat(localStorage.getItem('ttsRate')) || 1;
      
      const selectedVoice = document.getElementById('voiceSelect').selectedOptions[0];
      if (selectedVoice) {
        const voice = voices.find(v => v.name === selectedVoice.getAttribute('data-voice'));
        if (voice) utterance.voice = voice;
      }
      
      currentUtterance = utterance;
      speechSynthesis.speak(utterance);
    }

    function stopSpeaking() {
      speechSynthesis.cancel();
      currentUtterance = null;
    }

    function speakLastResponse() {
      const messages = document.getElementById('chat').querySelectorAll('div');
      if (messages.length > 0) {
        speak(messages[messages.length - 1].textContent.replace('Bot : ', ''));
      }
    }

    function toggleAutoTTS() {
      autoSpeak = !autoSpeak;
      localStorage.setItem('autoTTS', autoSpeak);
      document.getElementById('toggleAutoTTS').textContent = `Auto TTS: ${autoSpeak ? 'ON' : 'OFF'}`;
    }

    function setVoice() {}
    function setRate(e) { localStorage.setItem('ttsRate', e.target.value); }

    // Charger l'historique
    window.onload = () => {
      fetch('history.php')
        .then(res => res.json())
        .then(history => {
          const chat = document.getElementById('chat');
          history.forEach(entry => {
            chat.innerHTML += `<div><b>Vous :</b> ${entry.user}</div><div><b>Bot :</b> ${entry.bot}</div>`;
          });
          chat.scrollTop = chat.scrollHeight;
        });
    };</script><script>
const images = ["2.jpg"];
const randomBg = images[Math.floor(Math.random() * images.length)];
document.body.style.backgroundImage = `url(${randomBg})`;
document.body.classList.add("dynamic-bg"); // Apply the CSS class
</script></body>
</html>